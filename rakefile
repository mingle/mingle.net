require 'rspec/core/rake_task'

apisln = 'StudiosApi.sln'
cfg = ENV["CONFIG"] == nil ? "Release" : ENV["CONFIG"]

task :build => [:clean, :compile, :spec, :installer]

task :compile do
	puts "Building '#{apisln}' using '#{cfg}' configuration."
	sh "msbuild.exe /t:Rebuild /p:configuration=#{cfg} #{apisln}" 
end

task :clean do
	clean 'build'
	sh "devenv.exe #{apisln} /Clean "
end

task :bundler do
	sh "bundle install --deployment vendor" 
end

task :doc do
	sh "msbuild.exe /p:configuration=#{cfg}  documentation.shfbproj"
end

task :installer do
	sh "devenv ApiSetup/ApiSetup.vdproj /Rebuild #{cfg} /Log StudiosApiSetupLog.txt"
end

RSpec::Core::RakeTask.new(:spec) do |t|
  t.skip_bundler = true
end

def clean path
	rm_r path if File.exists? path
end


