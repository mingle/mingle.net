require 'rspec/core/rake_task'

apisln = 'StudiosApi.sln'
cfg = ENV["CONFIG"]
dotnet = ENV["DOTNETPATH"]
vspath = ENV["VSPATH"]
tfsTestContainer = './TfsSynchronizer/build/tests/TestSynchronizer.dll'
tfsTestSettings = './TfsSynchronizer/Local.testsettings'

task :build => [:clean, :compile, :spec]

task :compile do
	puts "Building '#{apisln}' using '#{cfg}' configuration."
#	sh "#{dotnet}msbuild.exe /t:Rebuild /p:configuration=#{cfg} #{apisln}"
	sh "devenv #{apisln} /Rebuild #{cfg} /Log StudiosApiBuildLog.txt" 
end

task :clean do
	clean 'build'
	sh "devenv.exe #{apisln} /Clean "
end

RSpec::Core::RakeTask.new(:spec) do |t|
  t.skip_bundler = true
end

task :install do
	clean '.bundle'
	mkdir 'vendor' unless File.exists? 'vendor'
	sh 'bundle install --path vendor'
end

def clean path
	rm_r path if File.exists? path
end

task :deploy do
	sh "deploy.bat"
end

